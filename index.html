<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Beauty Shop</title>
  <meta name="description" content="магазин уходовой косметики" />
  <style>
  :root {
    --bg: #fafdfb;
    --panel: #ffffff;
    --muted: #5f7468;         
    --text: #274a36;          
    --accent: #0f3d2e;
    --accent-2: #1b5a45; 
    --danger: #d66969;        
    --border: #cfe3d8;       
    --shadow: 0 6px 18px rgba(185, 214, 200, .25);
    --radius: 18px;
    --focus: #2f7a57;        
  }

  * { box-sizing: border-box; }
  html, body { height: 100%; }
  body {
    margin: 0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.5;
  }

  header {
    position: sticky; top: 0; z-index: 50;
    backdrop-filter: blur(8px);
    background: rgba(255,255,255,.8);
    border-bottom: 1px solid var(--border);
  }
  .container { max-width: 1100px; margin: 0 auto; padding: 16px; }
  .brand { display:flex; align-items:center; gap:12px; }
  .brand .logo {
    width: 36px; height: 36px; border-radius: 10px;
    background: radial-gradient(circle at 30% 30%, var(--accent), var(--accent-2));
    box-shadow: var(--shadow);
  }
  .brand h1 { font-size: 20px; margin: 0; letter-spacing:.3px; }

  .actions { display:flex; gap:8px; }

  button, .btn {
    appearance: none; border: 1px solid transparent; border-radius: 12px;
    padding: 10px 14px; cursor: pointer; font-weight: 700;
    transition: transform .05s ease, filter .2s ease, box-shadow .2s ease, border-color .2s ease;
  }
  .btn { background: var(--text); color: #fff; }
  .btn:hover { filter: brightness(1.05); }
  .btn:active { transform: translateY(1px); }
  .btn:focus-visible {
    outline: 3px solid transparent;
    box-shadow: 0 0 0 3px var(--accent), 0 0 0 5px var(--focus);
  }

  .btn[disabled]{
    opacity: .6;
    cursor: not-allowed;
    filter: none;
    transform: none;
  }

  .btn-accent { background: var(--accent); color: #ffffff; }
  .btn-accent:focus-visible {
    outline: 3px solid transparent;
    box-shadow: 0 0 0 3px #e9f7f1, 0 0 0 5px var(--focus);
  }

  .btn-ghost {
    background: transparent; color: var(--text); border: 1px solid var(--border);
  }
  .btn-ghost:hover { filter: none; border-color: #9ccab5; }

  main { padding: 24px 16px 64px; }

  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 16px;
  }

  .card {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    overflow: hidden;
    display: flex; flex-direction: column;
  }
  .card figure { height: 240px; background: var(--bg); display:grid; place-items:center; }
  .card figure img { max-width: 100%; max-height: 100%; object-fit: contain; filter: drop-shadow(0 10px 18px rgba(0,0,0,.25)); }
  .card .content { padding: 12px; display:flex; flex-direction:column; gap:10px; }
  .title { font-size: 16px; margin: 0; }
  .price { font-weight: 800; }
  .muted { color: var(--muted); font-size: 14px; }

  aside.cart {
    position: fixed; right: 0; top: 0; bottom: 0; width: 360px; max-width: 100%;
    background: #ffffffee;
    border-left: 1px solid var(--border);
    transform: translateX(100%);
    transition: transform .25s ease;
    z-index: 60; display:flex; flex-direction:column;
  }
  aside.cart.open { transform: translateX(0); }
  .cart-header { padding: 16px; display:flex; align-items:center; justify-content: space-between; border-bottom:1px solid var(--border); }
  .cart-items { padding: 8px 12px; overflow: auto; flex: 1; display:flex; flex-direction:column; gap:10px; }

  .cart-item {
    display:grid; grid-template-columns: 1fr auto; gap:8px;
    background: #ffffff; border:1px solid var(--border);
    border-radius:12px; padding:10px;
  }
  .cart-row { display:flex; align-items:center; gap:8px; }

  .qty { width: 80px; }
  .qty input {
    width: 100%; padding: 8px 10px; border-radius: 10px;
    border:1px solid var(--border); background:#fff; color:#0b1022;
  }
  .qty input:focus-visible {
    outline: 3px solid transparent;
    box-shadow: 0 0 0 3px var(--accent), 0 0 0 5px var(--focus);
    border-color: #9ccab5;
  }

  .remove {
    background: transparent; color: var(--danger);
    border: 1px solid var(--danger); font-weight: 700;
  }
  .remove:hover { filter: brightness(1.05); }
  .remove:focus-visible {
    outline: 3px solid transparent;
    box-shadow: 0 0 0 3px #fde9e9, 0 0 0 5px var(--danger);
  }

  .cart-footer { border-top:1px solid var(--border); padding: 16px; display:grid; gap:10px; }
  .total { display:flex; align-items:center; justify-content: space-between; font-weight:800; }

  dialog {
    border: 1px solid var(--border); border-radius: 16px; padding: 0;
    max-width: 560px; width: 96vw; background: #ffffffee; color: var(--text); box-shadow: var(--shadow);
  }
  dialog::backdrop { backdrop-filter: blur(4px); background: rgba(0,0,0,.5); }
  .modal-head { padding: 16px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center; }
  .modal-body { padding: 16px; display:grid; gap:12px; }
  form.checkout { display:grid; gap:12px; }
  .field { display:grid; gap:6px; }
  .field label { font-size: 14px; color: var(--muted); }

  .field input, .field textarea {
    padding: 12px 12px; border-radius: 12px;
    border:1px solid var(--border); background:#fff; color:#0b1022;
  }
  .field input::placeholder, .field textarea::placeholder { color: #7a8d83; }
  .field input:focus-visible, .field textarea:focus-visible {
    outline: 3px solid transparent;
    box-shadow: 0 0 0 3px var(--accent), 0 0 0 5px var(--focus);
    border-color: #9ccab5;
  }

  .modal-actions { display:flex; justify-content:flex-end; gap:10px; padding: 16px; border-top:1px solid var(--border); }

  .sr-only { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }

  @media (max-width: 900px) {
    .container { padding: 12px; }
    .card figure { height: 180px; }
    aside.cart { width: 92vw; }
  }
  @media (max-width: 520px) {
    header .container { display:grid; grid-template-columns: 1fr auto; gap:10px; }
    .brand h1 { font-size: 18px; }
    .grid { gap: 12px; }
    .card { border-radius: 14px; }
  }
  </style>
</head>
<body>
  <header>
    <div class="container" style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
      <div class="brand" aria-label="Beauty Shop">
        <div class="logo" aria-hidden="true"></div>
        <h1>Beauty Shop</h1>
      </div>
      <nav class="actions" aria-label="Основные действия">
        <button class="btn-ghost" id="toggleCart" aria-controls="cart" aria-expanded="false">Корзина <span id="cartCount" class="muted" style="margin-left:6px;">0</span></button>
        <button class="btn-accent" id="openCheckout">Оформить заказ</button>
      </nav>
    </div>
  </header>

  <main class="container">
    <section aria-labelledby="catalog-title">
      <h2 id="catalog-title" class="sr-only">Каталог</h2>
      <div class="grid" id="products"></div>
    </section>
  </main>

  
  <aside class="cart" id="cart" aria-labelledby="cartTitle" aria-hidden="true">
    <div class="cart-header">
      <h2 id="cartTitle" style="margin:0">Корзина</h2>
      <button class="btn-ghost" id="closeCart">Закрыть</button>
    </div>
    <div class="cart-items" id="cartItems" role="list"></div>
    <div class="cart-footer">
      <div class="total"><span>Итого:</span> <span id="cartTotal">0 ₽</span></div>
      <button class="btn" id="clearCart" title="Очистить корзину">Очистить</button>
      <button class="btn-accent" id="checkoutFromCart">Оформить заказ</button>
    </div>
  </aside>

  <dialog id="checkoutDialog" aria-labelledby="checkoutTitle">
    <div class="modal-head">
      <h3 id="checkoutTitle" style="margin:0">Оформление заказа</h3>
      <button class="btn-ghost" id="closeDialog" aria-label="Закрыть">✕</button>
    </div>
    <div class="modal-body">
      <form class="checkout" id="checkoutForm">
        <div class="field">
          <label for="firstName">Имя*</label>
          <input id="firstName" name="firstName" autocomplete="given-name" required />
        </div>
        <div class="field">
          <label for="lastName">Фамилия*</label>
          <input id="lastName" name="lastName" autocomplete="family-name" required />
        </div>
        <div class="field">
          <label for="address">Адрес доставки*</label>
          <textarea id="address" name="address" rows="3" required></textarea>
        </div>
        <div class="field">
          <label for="phone">Контактный телефон*</label>
          <input id="phone" name="phone" type="tel" placeholder="+7 (___) ___-__-__" required />
        </div>
        <p class="muted">Поля, отмеченные *, обязательны к заполнению.</p>
        <div class="modal-actions">
          <button type="button" class="btn-ghost" id="cancelOrder">Отмена</button>
          <button type="submit" class="btn">Создать заказ</button>
        </div>
      </form>
    </div>
  </dialog>

  <template id="productCardTpl">
    <article class="card">
      <figure>
        <img alt="" />
      </figure>
      <div class="content">
        <h3 class="title"></h3>
        <p class="muted desc"></p>
        <div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
          <span class="price"></span>
          <button class="btn add">Добавить в корзину</button>
        </div>
      </div>
    </article>
  </template>

  <template id="cartItemTpl">
    <div class="cart-item" role="listitem">
      <div>
        <div class="title"></div>
        <div class="muted">Цена: <span class="unit"></span> · Сумма: <span class="sum"></span></div>
      </div>
      <div class="cart-row">
        <div class="qty"><input type="number" min="1" step="1" value="1" aria-label="Количество"></div>
        <button class="remove">Удалить</button>
      </div>
    </div>
  </template>

  <script>
    const PRODUCTS = [
      { id: 'p1', title: 'Body Cream',  price: 3321, img: 'bodycream.jpg',   desc: 'Увлажняющий крем для тела, 195 мл', stock: 5 },
      { id: 'p2', title: 'Hand Soap',   price: 2061, img: 'hand soap.jpg',   desc: 'Жидкое мыло для рук, 300 мл',       stock: 9 },
      { id: 'p3', title: 'Shower Gel',  price: 2151, img: 'shower gel.jpg',  desc: 'Гель для душа, 300 мл',             stock: 4 },
    ];

    const LS_KEY = 'beauty_shop_cart_v1';
    const saveCart = (cart) => localStorage.setItem(LS_KEY, JSON.stringify(cart));
    const loadCart = () => {
      try { return JSON.parse(localStorage.getItem(LS_KEY)) || {}; }
      catch { return {}; }
    };

    let cart = loadCart();

    const fmt = (n) => new Intl.NumberFormat('ru-RU').format(n);
    const rub = (n) => `${fmt(n)} ₽`;

    const productsEl   = document.getElementById('products');
    const productTpl   = document.getElementById('productCardTpl');
    const cartEl       = document.getElementById('cart');
    const cartItemsEl  = document.getElementById('cartItems');
    const cartTotalEl  = document.getElementById('cartTotal');
    const cartCountEl  = document.getElementById('cartCount');

    const getQty = (id) => (cart[id]?.qty ?? 0);

    function renderCatalog() {
      const frag = document.createDocumentFragment();
      PRODUCTS.forEach(p => {
        const node = productTpl.content.cloneNode(true);
        const img = node.querySelector('img');
        img.src = p.img;
        img.alt = p.title;

        node.querySelector('.title').textContent = p.title;
        node.querySelector('.desc').textContent = p.desc;
        node.querySelector('.price').textContent = rub(p.price);

        const addBtn = node.querySelector('.add');
        addBtn.addEventListener('click', () => addToCart(p));

        frag.appendChild(node);
      });
      productsEl.appendChild(frag);
      syncCatalogUI();
    }

    function addToCart(prod) {
      const inCart = getQty(prod.id);
      const max = prod.stock ?? Infinity;
      if (inCart >= max) {
        alert('Товара больше нет в наличии');
        return;
      }
      const item = cart[prod.id] || { id: prod.id, title: prod.title, price: prod.price, qty: 0 };
      item.qty += 1;
      cart[prod.id] = item;
      saveCart(cart);
      renderCart(false);
      syncCatalogUI();
    }

    function removeFromCart(id) {
      delete cart[id];
      saveCart(cart);
      renderCart();
      syncCatalogUI();
    }

    function updateQty(id, qty) {
      const q = Math.max(1, Number(qty) || 1);
      const prod = PRODUCTS.find(p => p.id === id);
      const max = prod?.stock ?? q;
      cart[id].qty = Math.min(q, max);
      saveCart(cart);
      renderCart(false); 
      syncCatalogUI();
    }

    function calcTotals() {
      const items = Object.values(cart);
      const count = items.reduce((s, i) => s + i.qty, 0);
      const total = items.reduce((s, i) => s + i.price * i.qty, 0);
      return { count, total };
    }

    function renderCart(openIfHasItems = false) {
      while (cartItemsEl.firstChild) {
        cartItemsEl.removeChild(cartItemsEl.firstChild);
      }
      const tpl = document.getElementById('cartItemTpl');
      const frag = document.createDocumentFragment();

      for (const item of Object.values(cart)) {
        const node = tpl.content.cloneNode(true);
        node.querySelector('.title').textContent = item.title;
        node.querySelector('.unit').textContent = rub(item.price);
        node.querySelector('.sum').textContent  = rub(item.price * item.qty);

        const qtyInput = node.querySelector('input');
        qtyInput.value = item.qty;
        qtyInput.addEventListener('input', (e) => updateQty(item.id, e.target.value));

        node.querySelector('.remove').addEventListener('click', () => removeFromCart(item.id));
        frag.appendChild(node);
      }

      cartItemsEl.appendChild(frag);
      const { count, total } = calcTotals();
      cartTotalEl.textContent = rub(total);
      cartCountEl.textContent = count;

      if (openIfHasItems && count > 0) openCart();
    }

    function syncCatalogUI() {
      const cards = document.querySelectorAll('#products .card');
      cards.forEach((card, idx) => {
        const p = PRODUCTS[idx];
        const btn = card.querySelector('.add');
        const left = (p.stock ?? Infinity) - getQty(p.id);
        const isOut = left <= 0;
        btn.disabled = isOut;
        btn.textContent = isOut ? 'Нет в наличии' : 'Добавить в корзину';
        const priceEl = card.querySelector('.price');
        priceEl.setAttribute('title', `Остаток: ${isFinite(left) ? left : '∞'}`);
      });
    }

    const toggleCartBtn = document.getElementById('toggleCart');
    const closeCartBtn  = document.getElementById('closeCart');
    function openCart() {
      cartEl.classList.add('open');
      cartEl.setAttribute('aria-hidden', 'false');
      toggleCartBtn.setAttribute('aria-expanded', 'true');
    }
    function closeCart() {
      cartEl.classList.remove('open');
      cartEl.setAttribute('aria-hidden', 'true');
      toggleCartBtn.setAttribute('aria-expanded', 'false');
    }
    toggleCartBtn.addEventListener('click', () => {
      if (cartEl.classList.contains('open')) closeCart(); else openCart();
    });
    closeCartBtn.addEventListener('click', closeCart);

    document.getElementById('clearCart').addEventListener('click', () => {
      cart = {}; saveCart(cart); renderCart(); syncCatalogUI();
    });

    const dialog = document.getElementById('checkoutDialog');
    const openCheckoutBtn = document.getElementById('openCheckout');
    const checkoutFromCartBtn = document.getElementById('checkoutFromCart');
    const closeDialogBtn = document.getElementById('closeDialog');
    const cancelOrderBtn = document.getElementById('cancelOrder');
    const form = document.getElementById('checkoutForm');

    function openDialog() {
      if (typeof dialog.showModal === 'function') {
        dialog.showModal();
      } else {
        dialog.setAttribute('open', '');
      }
    }
    function closeDialog() { dialog.close(); }

    openCheckoutBtn.addEventListener('click', openDialog);
    checkoutFromCartBtn.addEventListener('click', openDialog);
    closeDialogBtn.addEventListener('click', closeDialog);
    cancelOrderBtn.addEventListener('click', closeDialog);

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      if (!form.reportValidity()) return;
      alert('Заказ создан!');
      cart = {}; saveCart(cart); renderCart(); syncCatalogUI();
      form.reset();
      closeDialog();
    });

    
    renderCatalog();
    renderCart();

    setInterval(() => {
      saveCart(cart);
      const { count, total } = calcTotals();
      cartTotalEl.textContent = rub(total);
      cartCountEl.textContent = count;
    }, 1000);
  </script>
</body>
</html>
